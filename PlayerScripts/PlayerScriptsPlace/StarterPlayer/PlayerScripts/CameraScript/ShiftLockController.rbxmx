<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="ModuleScript" referent="RBX26256E453C1F4887BE2F64B30627ABD8">
		<Properties>
			<string name="Name">ShiftLockController</string>
			<ProtectedString name="Source">local ContextActionService = game:GetService(&apos;ContextActionService&apos;)
local Players = game:GetService(&apos;Players&apos;)
local StarterPlayer = game:GetService(&apos;StarterPlayer&apos;)
local UserInputService = game:GetService(&apos;UserInputService&apos;)
-- Settings and GameSettings are read only
local Settings = UserSettings()&#9;-- ignore warning
local GameSettings = Settings.GameSettings

local ShiftLockController = {}

--[[ Script Variables ]]--
while not Players.LocalPlayer do
&#9;wait()
end
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local PlayerGui = LocalPlayer:WaitForChild(&apos;PlayerGui&apos;)
local ScreenGui = nil
local ShiftLockIcon = nil
local IsShiftLockMode = false
if not UserInputService.TouchEnabled then&#9;-- TODO: Remove when safe on mobile
&#9;IsShiftLockMode = StarterPlayer.EnableMouseLockOption and GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch
end
local IsShiftLocked = false
local LastShiftLockState = false
local Callbacks = {}

--[[ Constants ]]--
local SHIFT_LOCK_OFF = &apos;rbxasset://textures/ui/mouseLock_off.png&apos;
local SHIFT_LOCK_ON = &apos;rbxasset://textures/ui/mouseLock_on.png&apos;
local SHIFT_LOCK_CURSOR = &apos;rbxasset://textures/MouseLockedCursor.png&apos;

local function toggleShiftLock()
&#9;IsShiftLocked = not IsShiftLocked
&#9;LastShiftLockState = IsShiftLocked
end

local function onShiftLockToggled()
&#9;toggleShiftLock()
&#9;if IsShiftLocked then
&#9;&#9;ShiftLockIcon.Image = SHIFT_LOCK_ON
&#9;&#9;Mouse.Icon = SHIFT_LOCK_CURSOR
&#9;&#9;UserInputService.MouseBehavior = Enum.MouseBehavior.LockCenter
&#9;else
&#9;&#9;ShiftLockIcon.Image = SHIFT_LOCK_OFF
&#9;&#9;Mouse.Icon = &quot;&quot;
&#9;&#9;UserInputService.MouseBehavior = Enum.MouseBehavior.Default
&#9;end
end

local function initialize()
&#9;if ScreenGui then
&#9;&#9;ScreenGui:Destroy()
&#9;&#9;ScreenGui = nil
&#9;end
&#9;ScreenGui = Instance.new(&apos;ScreenGui&apos;)
&#9;ScreenGui.Name = &quot;ControlGui&quot;
&#9;
&#9;local frame = Instance.new(&apos;Frame&apos;)
&#9;frame.Name = &quot;BottomLeftControl&quot;
&#9;frame.Size = UDim2.new(0, 130, 0, 46)
&#9;frame.Position = UDim2.new(0, 0, 1, -46)
&#9;frame.BackgroundTransparency = 1
&#9;frame.Parent = ScreenGui
&#9;
&#9;ShiftLockIcon = Instance.new(&apos;ImageButton&apos;)
&#9;ShiftLockIcon.Name = &quot;MouseLockLabel&quot;
&#9;ShiftLockIcon.Size = UDim2.new(0, 62, 0, 62)
&#9;ShiftLockIcon.Position = UDim2.new(0, 2, 0, -65)
&#9;ShiftLockIcon.BackgroundTransparency = 1
&#9;ShiftLockIcon.Image = SHIFT_LOCK_OFF
&#9;ShiftLockIcon.Visible = IsShiftLockMode
&#9;ShiftLockIcon.Parent = frame
&#9;
&#9;ShiftLockIcon.MouseButton1Click:connect(onShiftLockToggled)
&#9;
&#9;ScreenGui.Parent = PlayerGui
end

function ShiftLockController:IsShiftLocked()
&#9;return IsShiftLocked
end

local function onShiftLockEnabled()
&#9;if ShiftLockIcon then
&#9;&#9;IsShiftLockMode = LocalPlayer.DevEnableMouseLock and GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch
&#9;&#9;ShiftLockIcon.Visible = IsShiftLockMode
&#9;&#9;if not IsShiftLockMode then
&#9;&#9;&#9;IsShiftLocked = false
&#9;&#9;&#9;Mouse.Icon = &quot;&quot;
&#9;&#9;&#9;ShiftLockIcon.Image = SHIFT_LOCK_OFF
&#9;&#9;&#9;UserInputService.MouseBehavior = Enum.MouseBehavior.Default
&#9;&#9;elseif LastShiftLockState then
&#9;&#9;&#9;IsShiftLocked = true
&#9;&#9;&#9;Mouse.Icon = SHIFT_LOCK_CURSOR
&#9;&#9;&#9;ShiftLockIcon.Image = SHIFT_LOCK_ON
&#9;&#9;&#9;UserInputService.MouseBehavior = Enum.MouseBehavior.LockCenter
&#9;&#9;else
&#9;&#9;&#9;Mouse.Icon = &quot;&quot;
&#9;&#9;&#9;ShiftLockIcon.Image = SHIFT_LOCK_OFF
&#9;&#9;&#9;UserInputService.MouseBehavior = Enum.MouseBehavior.Default
&#9;&#9;end
&#9;end
end

GameSettings.Changed:connect(function(property)
&#9;if property == &apos;ControlMode&apos; then
&#9;&#9;onShiftLockEnabled()
&#9;end
end)

LocalPlayer.Changed:connect(function(property)
&#9;if property == &apos;DevEnableMouseLock&apos; then
&#9;&#9;onShiftLockEnabled()
&#9;end
end)

LocalPlayer.CharacterAdded:connect(function(character)
&#9;initialize()
end)

local mouseLockSwitchFunc = function(actionName, inputState, inputObject)
&#9;if IsShiftLockMode and inputState == Enum.UserInputState.Begin then
&#9;&#9;onShiftLockToggled()
&#9;end
end

initialize()
if not UserInputService.TouchEnabled then --TODO: Remove when safe!
&#9;ContextActionService:BindActionToInputTypes(&quot;checkMouseLockSwitch&quot;, mouseLockSwitchFunc, false, Enum.KeyCode.LeftShift, Enum.KeyCode.RightShift)
end

return ShiftLockController
</ProtectedString>
		</Properties>
	</Item>
</roblox>